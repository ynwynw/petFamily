<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.petback.mapper.FosterMapper">

    <resultMap id="FosterResultMap" type="com.example.petback.entity.Foster">
        <id property="id" column="id"/>
        <result property="userName" column="userName"/>
        <result property="roomName" column="roomName"/>
        <!-- 映射userName -->
        <association property="userName" column="userId" select="selectUserName"/>
        <!-- 映射animalImg -->
        <association property="roomName" column="roomId" select="selectRoomName"/>

        <!-- 其他Adopt表的字段映射 -->
        <!-- ... -->
    </resultMap>

    <select id="selectUserName" resultType="String">
        SELECT name FROM user WHERE id = #{userId}
    </select>

    <select id="selectRoomName" resultType="String">
        SELECT name FROM room WHERE id = #{roomId}
    </select>


    <select id="selectByPage" resultMap="FosterResultMap">
        SELECT f.*, u.name AS userName, ro.name AS roomName
        FROM foster f
        LEFT JOIN user u ON f.user_id = u.id
        LEFT JOIN room ro ON f.room_id = ro.id
        <where>
            <if test="animalName != null and animalName != ''">
                AND f.name LIKE CONCAT('%', #{animalName}, '%')
            </if>
            <if test="status != null and status != ''">
                AND f.status LIKE CONCAT('%', #{status}, '%')
            </if>
            <if test="userId!=null and userId!='' and userId!=-1">
                AND f.user_id = #{userId}
            </if>
        </where>
    </select>

    <select id="selectAll" resultType="com.example.petback.entity.Foster">
        select foster.*, user.name as userName, room.name as roomName
        from foster
        left join user on foster.user_id = user.id
        left join room on foster.room_id = room.id
        <where>
            <if test="id != null"> and id= #{id}</if>
            <if test="status != null"> and foster.status = #{status}</if>
            <if test="userId != null"> and foster.user_id = #{userId}</if>
        </where>
        order by id desc
    </select>





</mapper>